# updated to 2025.7.2 - Fixed API Config
################################################################################
# Substitution Variables
################################################################################
substitutions:
  device_internal_name: espdisplay7
  device_wifi_name: esphome-19
  device_friendly_name: EspDisplay7
  device_ip_address: !secret ip_address
  device_sampling_time: 30s

################################################################################
# Globals
################################################################################
globals: ##to set default reboot behavior
  - id: wifi_connection
    type: bool
    restore_value: no
    initial_value: "false"

################################################################################
# Board Configuration
################################################################################
esphome:
  name: ${device_internal_name}
  friendly_name: ${device_friendly_name}
  platformio_options:
    build_flags: "-DBOARD_HAS_PSRAM"
    board_build.arduino.memory_type: qio_opi
    board_build.flash_mode: dio
    board_upload.maximum_ram_size: 524288

psram:
  mode: octal
  speed: 120MHz

esp32:
  board: esp32-s3-devkitc-1
  flash_size: 8MB
  cpu_frequency : 240MHz
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESP32S3_DATA_CACHE_64KB: "y"
      CONFIG_ESPTOOLPY_FLASHSIZE_8MB: "y"
      CONFIG_FREERTOS_HZ: "1000"
      CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240: y
      CONFIG_ESPTOOLPY_FLASHMODE_QIO: y
      CONFIG_ESPTOOLPY_FLASHFREQ_120M: y
      CONFIG_SPIRAM_MODE_OCT: y
      CONFIG_IDF_EXPERIMENTAL_FEATURES: y
      CONFIG_SPIRAM_SPEED_120M: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y
      CONFIG_ESP32S3_DATA_CACHE_LINE_64B: y
      #CONFIG_COMPILER_OPTIMIZATION_SIZE: y
      CONFIG_COMPILER_OPTIMIZATION_PERF: y
      #CONFIG_COMPILER_OPTIMIZATION_DEBUG: y
    advanced:
      enable_idf_experimental_features: True

################################################################################
# Enable logging
################################################################################
logger:
  baud_rate: 0
  level: ERROR

################################################################################
# Enable Home Assistant API
################################################################################
api:
  reboot_timeout: 0s
  encryption:
    key: !secret api_encryption_key2
  # Eliminada la línea 'keepalive' que causaba el error.

################################################################################
# OTA
################################################################################
ota:
  platform: esphome
  password: !secret web_server_password

################################################################################
# WiFi
################################################################################
wifi:
  networks:
    - ssid: !secret wifi_ssid
      password: !secret wifi_password
  manual_ip:
    static_ip: ${device_ip_address}
    gateway: !secret gateway_address
    subnet: !secret subnet_address
  power_save_mode: none
  fast_connect: true
# --- NUEVOS EVENTOS ---
  on_connect:
    - lvgl.label.update:
        id: wifi_status_label
        text: "Conectado a WiFi ✓"
  on_disconnect:
    - lvgl.label.update:
        id: wifi_status_label
        text: "Conectando a WiFi..."
  # ----------------------

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    password: !secret web_server_password

captive_portal:

################################################################################
# Web Server
################################################################################
web_server:
  port: 80
  version: 2
  include_internal: true
  auth:
    username: !secret web_server_user
    password: !secret web_server_password
  local: true

################################################################################
# IO Extender
################################################################################
ch422g:
  - id: ch422g_hub

################################################################################
# Switch (Lógica corregida para Temas LVGL)
################################################################################
switch:
  - platform: restart
    name: "Restart"
    id: device_restart
  
  - platform: safe_mode
    name: Use Safe Mode
    id: device_safe_mode
    
  - platform: gpio
    id: lcdbacklight
    name: lcdbacklight
    pin:
      ch422g: ch422g_hub
      number: 2
      mode: output
      inverted: false
    restore_mode: ALWAYS_ON

  # Pruebas
  - platform: homeassistant
    id: control_dispositivo_ha
    name: prueba
    entity_id: light.hexagon

  # ================= TAB 1 =================

  # 1. A/C (Botón id0)
  - platform: homeassistant
    id: mabe_fan
    name: ac
    entity_id: fan.mabe
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id0), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id0), LV_STATE_CHECKED);

  # 2. Pecera (Botón id1)
  - platform: homeassistant
    id: pecera_enchufe
    name: pecera
    entity_id: switch.pecera_enchufe_1
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id1), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id1), LV_STATE_CHECKED);

  # 3. Luz Cuarto (Botón id2)
  - platform: homeassistant
    id: luz_cuarto
    name: luzRoom
    entity_id: switch.luz_cuarto_interruptor
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id2), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id2), LV_STATE_CHECKED);

  # 4. Xiaomi TV (Botón id3)
  - platform: homeassistant
    id: tv_xiaomi
    name: xiaomi
    entity_id: remote.xiaomi
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id3), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id3), LV_STATE_CHECKED);

  # 5. Reloj Awtrix (Botón id4)
  - platform: homeassistant
    id: clock_led
    name: reloj
    entity_id: light.awtrix_e159dc_matrix
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id4), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id4), LV_STATE_CHECKED);

  # 6. Ambilight (Botón id5)
  - platform: homeassistant
    id: tv_ambilight
    name: ambilight
    entity_id: light.rgbic_tv_backlight_2
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id5), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id5), LV_STATE_CHECKED);

  # 7. Home Theater (Botón id6)
  - platform: homeassistant
    id: home_theather
    name: theather
    entity_id: switch.aquila_enchufe
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id6), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id6), LV_STATE_CHECKED);

  # 8. Fish Pump (Botón id7)
  - platform: homeassistant
    id: aquarium_pump
    name: fish_pump
    entity_id: switch.waterpump_enchufe
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id7), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id7), LV_STATE_CHECKED);

  # 9. Led Bar (Botón id8)
  - platform: homeassistant
    id: led_barras
    name: led_bar
    entity_id: light.wled
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id8), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id8), LV_STATE_CHECKED);

  # 10. Ducto (Botón id9)
  - platform: homeassistant
    id: ducto
    name: ducto_enchufe
    entity_id: switch.homeassistantpi_enchufe
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id9), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id9), LV_STATE_CHECKED);

  # 11. Humidifier (Botón id10)
  - platform: homeassistant
    id: smart_humidifier
    name: humidifier
    entity_id: humidifier.smart_humidifier
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id10), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id10), LV_STATE_CHECKED);

  # 12. Air Purifier (Botón id11)
  - platform: homeassistant
    id: air_purifier
    name: smar_purifier
    entity_id: switch.air_purifier_power_switch
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab1_id11), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab1_id11), LV_STATE_CHECKED);

  # ================= TAB 2 =================

  # 13. Hex Led (Botón Tab2 id0)
  - platform: homeassistant
    id: hex_led
    name: hex
    entity_id: light.hexagon
    on_turn_on:
      - lambda: lv_obj_add_state(id(btn_Tab2_id0), LV_STATE_CHECKED);
    on_turn_off:
      - lambda: lv_obj_clear_state(id(btn_Tab2_id0), LV_STATE_CHECKED);

################################################################################
# Time
################################################################################
time:
  - platform: homeassistant
    id: esptime
    on_time:
      # ACTUALIZA CADA SEGUNDO para mantener el motor LVGL despierto
      - seconds: /1    
        then:
          - lvgl.label.update:
              id: time_hour
              text:
                time_format: "%A %H:%M:%S"
                time: !lambda return id(esptime).now();

################################################################################
# Sensors
################################################################################
sensor:
  - platform: wifi_signal
    name: "WiFi Signal Sensor"
    id: ${device_internal_name}_wifi_signal_sensor
    update_interval: ${device_sampling_time}

  - platform: uptime
    name: "Uptime Sensor"
    id: ${device_internal_name}_uptime_sensor
    update_interval: ${device_sampling_time}
    internal: true
    on_raw_value:
      then:
        - text_sensor.template.publish:
            id: ${device_internal_name}_uptime_human
            state: !lambda |-
              int seconds = round(id(${device_internal_name}_uptime_sensor).raw_state);
              int days = seconds / (24 * 3600);
              seconds = seconds % (24 * 3600);
              int hours = seconds / 3600;
              seconds = seconds % 3600;
              int minutes = seconds /  60;
              seconds = seconds % 60;
              return (
                (days ? to_string(days) + "d " : "") +
                (hours ? to_string(hours) + "h " : "") +
                (minutes ? to_string(minutes) + "m " : "") +
                (to_string(seconds) + "s")
              ).c_str();

  - platform: homeassistant
    id: battery_charging
    entity_id: sensor.1be6e4_Battery_Power
    internal: true

  - platform: homeassistant
    id: grid_output
    entity_id: sensor.grid_output
    internal: true

  - platform: homeassistant
    id: grid_input
    entity_id: sensor.grid_input
    internal: true

  - platform: homeassistant
    id: solar_gen
    entity_id: sensor.1be6e4_ac_output_total_power
    internal: true

  - platform: homeassistant
    id: home_use
    entity_id: sensor.1be6e4_total_consumption_power
    internal: true

  - platform: homeassistant
    id: battery_soc
    entity_id: sensor.1be6e4_remaining_battery_capacity
    internal: true

################################################################################
# Text Sensors
################################################################################
text_sensor:
  - platform: wifi_info
    ip_address:
      name: IP Address
      id: ${device_internal_name}_ip_address
    ssid:
      name: Connected SSID
      id: ${device_internal_name}_connected_ssid
    mac_address:
      name: Mac Wifi Address
      id: ${device_internal_name}_mac_address

  - platform: template
    name: Uptime Human Readable
    id: ${device_internal_name}_uptime_human
    icon: mdi:clock-start

  - platform: template
    name: RTC
    id: label_clock

################################################################################
# Images
################################################################################
image:

  - file: "images/homeassistant-logo.png"
    id: ha_logo
    resize: 800x480
    type: RGB565

  - file: "images/Icons/air-conditioner-custom.png"
    id: ac_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/fish-custom.png"
    id: fish_icon
    resize: 32x32
    type: RGB565
    transparency: alpha_channel
  - file: "images/Icons/television-ambient-light-custom.png"
    id: lr_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/lightbulb.png"
    id: lightbulb_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/air-humidifier-custom.png"
    id: humidifier_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/air-purifier-custom.png"
    id: purifier_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/clock-digital-custom.png"
    id: clock_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/hexagon-multiple-custom.png"
    id: hexagon_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/hvac-custom.png"
    id: hvac_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/theater-custom.png"
    id: theater_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/led-strip-variant-custom.png"
    id: led_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/remote-tv-custom.png"
    id: tv_icon
    resize: 32x32
    type: RGB565
  - file: "images/Icons/water-pump-custom.png"
    id: pump_icon
    resize: 32x32
    type: RGB565

    
################################################################################
# Colors
################################################################################
color:
  - id: my_red
    red: 100%
    green: 0%
    blue: 0%
  - id: my_pink
    red: 100%
    green: 10%
    blue: 40%
  - id: my_yellow
    red: 100%
    green: 100%
    blue: 0%
  - id: my_green
    red: 0%
    green: 100%
    blue: 0%
  - id: my_blue
    red: 0%
    green: 0%
    blue: 100%
  - id: my_gray
    red: 50%
    green: 50%
    blue: 50%
  - id: my_white
    red: 100%
    green: 100%
    blue: 100%
  - id: my_black
    red: 0%
    green: 0%
    blue: 0%
  - id: my_cards
    red: 20%
    green: 20%
    blue: 20%
  - id: my_cyan
    hex: 4A90E2

################################################################################
# Fonts
################################################################################

font:
# Fuente para textos pequeños (etiquetas)
  - file: "gfonts://Roboto"
    id: roboto_14
    size: 14

  # Fuente para textos normales (botones)
  - file: "gfonts://Roboto"
    id: roboto_16
    size: 16

  # Fuente GIGANTE para el reloj
  - file: "gfonts://Roboto"
    id: roboto_clock
    size: 96
    glyphs: "0123456789:AMP" # Solo cargamos números para no llenar la memoria
  
  - file: "fonts/arial.ttf"
    id: arial_98
    size: 98
  - file: "fonts/arial.ttf"
    id: arial_96
    size: 96
  - file: "fonts/arial.ttf"
    id: arial_134
    size: 134
  - file: "fonts/arial.ttf"
    id: arial_128
    size: 128
  - file: "fonts/arial.ttf"
    id: arial_48
    size: 48
  - file: "fonts/arial.ttf"
    id: arial_36
    size: 36
  - file: "fonts/arial.ttf"
    id: arial_24
    size: 24
  - file: "fonts/arial.ttf"
    id: arial_12
    size: 12
  - file: "gfonts://Roboto"
    id: roboto10
    size: 10
    bpp: 4

################################################################################
# LVGL
################################################################################
lvgl:
  log_level: none
  color_depth: 16
  update_interval: 16ms
  buffer_size: 25%       # REDUCIDO para mejorar latencia
  text_font: roboto_14
  width: 800
  height: 480
  align: center
  id: screen

  theme:
    button:
      # --- ESTADO APAGADO ---
      radius: 16
      # IMPORTANTE: Intenta que este color sea IGUAL al fondo de tus iconos
      # Si tus iconos son gris oscuro, pon este bg_color igual.
      bg_color: 2763306      # Gris Oscuro (0x2A2A2A)
      bg_opa: 100%
      
      border_width: 0        # Sin borde apagado
      shadow_width: 0        # Sin sombra apagado (se ve plano/limpio)
      text_color: 15658734   # Blanco hueso
      
      # --- EFECTO AL PULSAR ---
      pressed:
        bg_color: 3552822    # Un gris un pelín más claro al tocar
        transform_height: -2 # Pequeño rebote

      # --- ESTADO ENCENDIDO (AQUÍ ESTÁ EL TRUCO) ---
      checked:
        # Mantenemos el fondo gris para que no choque con tu icono
        bg_color: 2763306    
        
        # Agregamos borde y sombra Cyan para indicar "ON"
        border_width: 2
        border_color: my_cyan
        
        # Efecto de luz de neón
        shadow_width: 20
        shadow_color: my_cyan
        shadow_opa: 60%      # Resplandor fuerte
        
        text_color: my_cyan  # El texto también se ilumina

    label:
      text_font: roboto_14

  widgets:
    - obj:
        height: 480
        width: 800
        align: center
        pad_all: 0
        bg_opa: 0%
        widgets:

        - tabview:
            bg_color: my_black
            text_color: my_white
            text_font: roboto_16
            id: paginador
            tabs:
              - name: "Eduardo Room"
                widgets:
                  - button:
                      x: 10
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id0
                      #checkable: true
                      widgets:
                        - image:
                            id: ac_image
                            src: ac_icon
                            align: TOP_MID
                        - label:

                            align: BOTTOM_MID 
                            text: "A/C"
                      on_click:
                        then:
                          - switch.toggle: mabe_fan
                  - button:
                      x: 100
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id1
                      checkable: true
                      widgets:
                        - image:
                            id: fish_image
                            src: fish_icon
                            align: TOP_MID
                            image_recolor: my_white
                            image_recolor_opa: 100%                            
                        - label:

                            align: BOTTOM_MID 
                            text: "Aquarium"
                      on_click:
                        then:
                          - switch.toggle: pecera_enchufe
                  - button:
                      x: 190
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id2
                      #checkable: true
                      widgets:
                        - image:
                            id: lr_image
                            src: lightbulb_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Luz Cuarto"
                      on_click:
                        then:
                          - switch.toggle: luz_cuarto
                  - button:
                      x: 280
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id3
                      #checkable: true
                      widgets:
                        - image:
                            id: tv_image
                            src: tv_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Xiaomi TV"
                      on_click:
                        then:
                          - switch.toggle: tv_xiaomi                                          
                  - button:
                      x: 370
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id4
                      #checkable: true
                      widgets:
                        - image:
                            id: cl_image
                            src: clock_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Clock"
                      on_click:
                        then:
                          - switch.toggle: clock_led 
                  - button:
                      x: 10
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id5
                      #checkable: true
                      widgets:
                        - image:
                            id: aa_image
                            src: lr_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "AmbiLight"
                      on_click:
                        then:
                          - switch.toggle: tv_ambilight 
                  - button:
                      x: 100
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id6
                      #checkable: true
                      widgets:
                        - image:
                            id: hh_image
                            src: theater_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Home Theater"
                      on_click:
                        then:
                          - switch.toggle: home_theather 
                  - button:
                      x: 190
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id7
                      #checkable: true
                      widgets:
                        - image:
                            id: aq_image
                            src: pump_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Aqua Pump"
                      on_click:
                        then:
                          - switch.toggle: aquarium_pump 
                  - button:
                      x: 280
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id8
                      
                      #checkable: true
                      widgets:
                        - image:
                            id: br_image
                            src: led_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Led Bar"
                      on_click:
                        then:
                          - switch.toggle: led_barras                                                                                                                                              
                  - button:
                      x: 370
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id9
                      #checkable: true
                      widgets:
                        - image:
                            id: hr_image
                            src: hvac_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Ducto"
                      on_click:
                        then:
                          - switch.toggle: ducto 
                  - button:
                      x: 460
                      y: 10
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id10
                      #checkable: true
                      widgets:
                        - image:
                            id: hsr_image
                            src: humidifier_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Humidifier"
                      on_click:
                        then:
                          - switch.toggle: smart_humidifier 
                  - button:
                      x: 460
                      y: 100
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab1_id11
                      #checkable: true
                      widgets:
                        - image:
                            id: pr_image
                            src: purifier_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Purifier"
                      on_click:
                        then:
                          - switch.toggle: air_purifier 
                  - label:
                      id: wifi_status_label
                      text_color: my_white
                      text_font: roboto_14
                      x: 400
                      y: 200

                                                

              - name: "3D Room"
                widgets:
                  - label:
                      align: center
                      text: "Página de control"
                  - button:
                      x: 85
                      y: 5
                      #align: center
                      width: 75
                      height: 75
                      id: btn_Tab2_id0
                      #checkable: true
                      widgets:
                        - image:
                            id: hex_image
                            src: hexagon_icon
                            align: TOP_MID
                            bg_color: my_white
                        - label:
                            text_font: roboto_14
                            align: BOTTOM_MID 
                            text: "Hexagons"
                      on_click:
                        then:
                          - switch.toggle: hex_led 
              - name: "Ajustes"
                widgets:
                  - label:
                      align: center
                      text: "Página de ajustes"

        - label:
            x: 50
            y: 50
            width: 100
            height: 80
            align: center
            text_font: roboto_clock
            id: time_hour
            text_color: my_white

    


################################################################################
# I2C
################################################################################
i2c:
  sda: GPIO08
  scl: GPIO09
  scan: True
  id: bus_a

################################################################################
# Display
################################################################################
display:
  - platform: rpi_dpi_rgb
    id: my_display
    update_interval: never
    auto_clear_enabled: false
    color_order: RGB
    pclk_frequency: 16MHZ
    dimensions:
      width: 800
      height: 480
    de_pin:
      number: 5
    hsync_pin:
      number: 46
      ignore_strapping_warning: true
    vsync_pin:
      number: 3
      ignore_strapping_warning: true
    pclk_pin: 7
    pclk_inverted: true
    reset_pin:
      ch422g: ch422g_hub
      number: 3
    hsync_back_porch: 8
    hsync_front_porch: 8
    hsync_pulse_width: 4
    vsync_back_porch: 16
    vsync_front_porch: 16
    vsync_pulse_width: 4
    data_pins:
      red:
        - 1
        - 2
        - 42
        - 41
        - 40
      blue:
        - 14
        - 38
        - 18
        - 17
        - 10
      green:
        - 39
        - 0
        - 45
        - 48
        - 47
        - 21

################################################################################
# Touchscreen
################################################################################
touchscreen:
  platform: gt911
  id: my_touch
  interrupt_pin: GPIO4
  reset_pin:
    ch422g: ch422g_hub
    number: 1
    mode: OUTPUT
  # Logs comentados para ahorrar CPU
  # on_touch:
  #   - lambda: |-
  #       ESP_LOGI("Touch", "Touch detected at x=%d, y=%d", touch.x, touch.y);
  # on_update:
  #   - lambda: |-
  #         for (auto touch: touches)  {
  #             if (touch.state <= 2) {
  #               ESP_LOGI("Touch points:", "id=%d x=%d, y=%d x.raw=%d, y.raw=%d", touch.id, touch.x, touch.y, touch.x_raw, touch.y_raw);
  #             }
  #         }